C51 COMPILER V9.00   OLED                                                                  01/08/2025 16:52:06 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE OLED
OBJECT MODULE PLACED IN .\Objects\OLED.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Code\OLED.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\OLED.lst) TABS(2) OBJECT(.\Objects\OLED.obj)

line level    source

   1          
   2          #include "OLED.h"
   3          #include "OLEDFont.h"
   4          #include "ds1302.h"
   5          
   6          /***OLED12864/0.96'/SSD1306***/
   7          
   8          /**
   9           * 51å»¶æ—¶å‡½æ•° @24MHzé¢‘ç‡ä¸‹
  10           * @param n æœ€å¤§ä¸º65535ï¼Œå•ä½æ¯«ç§’
  11           * @return: void
  12           */
  13          void Delay_ms(unsigned int n)
  14          {
  15   1          unsigned int i=0,j=0;
  16   1          for(i=0;i<n;i++)
  17   1              for(j=0;j<357;j++); 
  18   1      }
  19          
  20          /**
  21           * @function: void OLED_Write_Byte(uchar WCommand,uchar cmdORdata)
  22           * @description: 
  23           * @param {uchar WDataå¾…å†™å…¥çš„å†…å®¹ï¼Œuchar cmdORdataæŒ‡æ˜å†™å…¥æŒ‡ä»¤è¿˜æ˜¯æ•°æ®} 
  24           * @return: void
  25           */
  26          void OLED_Write_Byte(uchar WData, uchar cmdORdata)
  27          {
  28   1          I2C_Start();
  29   1          I2C_Write_Byte(OLED_Addr + 0); //å†™å…¥å™¨ä»¶åœ°å€(bit0=1è¯»ï¼Œbit0=0å†™)
  30   1          I2C_Wait_Ack();
  31   1          I2C_Write_Byte(cmdORdata); //æŒ‡æ˜å†™å…¥æŒ‡ä»¤è¿˜æ˜¯æ•°æ®
  32   1          I2C_Wait_Ack();
  33   1          I2C_Write_Byte(WData); //å†™å…¥æ•°æ®å†…å®¹
  34   1          I2C_Wait_Ack();
  35   1          I2C_Stop();
  36   1      }
  37          
  38          
  39          /// @brief å…¨å±æ˜¾ç¤ºç›¸åŒçš„æ•°æ®ï¼šç”¨äºæ¸…å±ã€äº®å±
  40          /// @param Fill_Data æ¸…å±ï¼š0x00  å…¨äº®å±ï¼š0xff
  41          void OLED_Fill(uchar Fill_Data)
  42          {
  43   1          uchar i, j;
  44   1          for (i = 0; i < 8; i++) //8é¡µï¼Œå…±éœ€è¦å¾ªç¯æ˜¾ç¤º8æ¬¡
  45   1          {
  46   2              OLED_Write_Byte(0xb0 + i, isCmd); //é¡µåœ°å€0~7
  47   2              OLED_Write_Byte(0x10, isCmd);     //è®¾ç½®é«˜ä½åˆ—åœ°å€
  48   2              OLED_Write_Byte(0x00, isCmd);     //è®¾ç½®ä½ä½åˆ—åœ°å€
  49   2              for (j = 0; j < OLED_Width; j++)  //æ¯é¡µæœ‰128åˆ—éœ€è¦æ˜¾ç¤º
  50   2                  OLED_Write_Byte(Fill_Data, isData);
  51   2          }
  52   1      }
  53          
  54          
C51 COMPILER V9.00   OLED                                                                  01/08/2025 16:52:06 PAGE 2   

  55          /// @brief è®¾ç½®èµ·å§‹æ˜¾ç¤ºä½ç½®
  56          /// @param x èµ·å§‹åˆ—ï¼Œå–å€¼èŒƒå›´0-127
  57          /// @param y èµ·å§‹è¡Œï¼Œå–å€¼èŒƒå›´0-7
  58          void OLED_Set_Pos(uchar x, uchar y)
  59          {
  60   1          OLED_Write_Byte(0xb0 + y, isCmd);               //èµ·å§‹æ˜¾ç¤ºçš„é¡µ
  61   1          OLED_Write_Byte((x & 0xf0) >> 4 | 0x10, isCmd); //è®¾ç½®é«˜ä½åˆ—åœ°å€
  62   1          OLED_Write_Byte(x & 0x0f, isCmd);               //è®¾ç½®ä½ä½åˆ—åœ°å€
  63   1      }
  64          
  65          /**
  66           * @function: void OLED_Init()
  67           * @description: OLEDåˆå§‹åŒ–å‡½æ•°
  68           */
  69          void OLED_Init()
  70          {
  71   1          Delay_ms(200);
  72   1          OLED_Write_Byte(0xae, isCmd); //å…³é—­æ˜¾ç¤ºå™¨ display off
  73   1          OLED_Write_Byte(0x00, isCmd); //è®¾ç½®ä½ä½åˆ—åœ°å€ set low column address
  74   1          OLED_Write_Byte(0x10, isCmd); //è®¾ç½®é«˜ä½åˆ—åœ°å€ set high column address
  75   1          OLED_Write_Byte(0x40, isCmd); //è®¾ç½®èµ·å§‹è¡Œåœ°å€ set start line address
  76   1          OLED_Write_Byte(0xb0, isCmd); //è®¾ç½®é¡µåœ°å€ set page address
  77   1        
  78   1          OLED_Write_Byte(0x81, isCmd); //è®¾ç½®å¯¹æ¯”åº¦
  79   1          OLED_Write_Byte(0x10, isCmd); //å¯¹æ¯”åº¦,æ•°å€¼è¶Šå¤§å±å¹•è¶Šäº®ï¼Œ0x00-0xff
  80   1        
  81   1          OLED_Write_Byte(0xa1, isCmd); //è®¾ç½®æ®µé‡æ–°æ˜ å°„ ä¸å·¦å³ç¿»è½¬set segment remap
  82   1          OLED_Write_Byte(0xa6, isCmd); //è®¾ç½®æ­£å¸¸/åå‘ normal / reverse
  83   1          OLED_Write_Byte(0xa8, isCmd); //è®¾ç½®å¤šè·¯å¤ç”¨æ¯”(1-64) set multiplex ratio(1 to 64)
  84   1          OLED_Write_Byte(0x3f, isCmd); //è®¾å®šå€¼1/32  1/32 duty
  85   1          OLED_Write_Byte(0xc8, isCmd); //æ‰«ææ–¹å‘ ä¸ä¸Šä¸‹ç¿»è½¬Com scan direction
  86   1      
  87   1          OLED_Write_Byte(0xd3, isCmd); //è®¾ç½®æ˜¾ç¤ºåç§» set display offset
  88   1          OLED_Write_Byte(0x00, isCmd); //
  89   1      
  90   1          OLED_Write_Byte(0xd5, isCmd); //è®¾ç½®oscåˆ†åŒº set osc division
  91   1          OLED_Write_Byte(0x80, isCmd); //
  92   1      
  93   1          OLED_Write_Byte(0xd8, isCmd); //å…³é—­åŒºåŸŸé¢œè‰²æ¨¡å¼ set area color mode off
  94   1          OLED_Write_Byte(0x05, isCmd); //
  95   1      
  96   1          OLED_Write_Byte(0xd9, isCmd); //è®¾ç½®é¢„å……ç”µæœŸ Set Pre-Charge Period
  97   1          OLED_Write_Byte(0xf1, isCmd); //
  98   1      
  99   1          OLED_Write_Byte(0xda, isCmd); //è®¾ç½®comå¼•è„šé…ç½® set com pin configuartion
 100   1          OLED_Write_Byte(0x12, isCmd); //
 101   1      
 102   1          OLED_Write_Byte(0xdb, isCmd); //è®¾ç½®vcomh set Vcomh
 103   1          OLED_Write_Byte(0x30, isCmd); //
 104   1      
 105   1          OLED_Write_Byte(0x8d, isCmd); //è®¾ç½®ç”µæºæ³µå¯ç”¨ set charge pump enable
 106   1          OLED_Write_Byte(0x14, isCmd); //
 107   1      
 108   1          OLED_Write_Byte(0xa4, isCmd); //è®¾ç½®å…¨å±€æ˜¾ç¤ºå¼€å¯ï¼›bit0ï¼Œ1å¼€å¯ï¼Œ0å…³é—­(ç™½å±/é»‘å±)
 109   1          OLED_Write_Byte(0xa6, isCmd); //è®¾ç½®æ˜¾ç¤ºæ–¹å¼ï¼Œbit0ï¼Œ1åç›¸æ˜¾ç¤ºï¼Œ0æ­£å¸¸æ˜¾ç¤º
 110   1      
 111   1          OLED_Write_Byte(0xaf, isCmd); //æ‰“å¼€oledé¢æ¿ turn on oled panel
 112   1      
 113   1          OLED_Fill(0x00); //æ¸…å±
 114   1      }
 115          
 116          
C51 COMPILER V9.00   OLED                                                                  01/08/2025 16:52:06 PAGE 3   

 117          /// @brief åœ¨oledç‰¹å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦
 118          /// @param x å–å€¼0-127
 119          /// @param y å–å€¼0-7
 120          /// @param DisplayChar éœ€è¦æ˜¾ç¤ºçš„å­—ç¬¦ï¼ˆç”¨â€™xâ€˜è¡¨ç¤ºï¼Œæˆ–ç›´æ¥ä¼ é€’asciiç ï¼‰
 121          void OLED_DisplayChar(uchar x, uchar y, uchar DisplayChar)
 122          {
 123   1          uchar c = 0, i;
 124   1          c = DisplayChar - 32; //ç­‰åŒäºå‡å»ä¸ªç©ºæ ¼c = DisplayChar - ' '; å¾—åˆ°æ˜¾ç¤ºå­—ç¬¦åœ¨åº“ä¸­çš„å
             -ç§»åœ°å€
 125   1          
 126   1              OLED_Set_Pos(x, y);                                 //å¼€å§‹æ˜¾ç¤ºä½ç½®
 127   1              for (i = 0; i < 8; i++)                             //æ˜¾ç¤ºä¸€ä¸ª8X16å­—ç¬¦çš„ä¸ŠåŠéƒ¨åˆ†
 128   1                  OLED_Write_Byte(F8X16[c * 16 + i], isData);     //å¾ªç¯æ˜¾ç¤ºæ•°ç»„ä¸­å‰8ä¸ªæ•°æ®
 129   1              OLED_Set_Pos(x, y + 1);                             //æ¢åˆ°ä¸‹ä¸€é¡µï¼Œæ˜¾ç¤ºå­—ç¬¦ä¸‹åŠéƒ¨åˆ†
 130   1              for (i = 0; i < 8; i++)                             //æ˜¾ç¤º8X16å­—ç¬¦çš„ä¸‹åŠéƒ¨åˆ†
 131   1                  OLED_Write_Byte(F8X16[c * 16 + i + 8], isData); //å¾ªç¯æ˜¾ç¤ºæ•°ç»„ä¸­å8ä¸ªæ•°æ®
 132   1      
 133   1      }
 134          
 135          
 136          /// @brief æ˜¾ç¤ºå¤§å­—ç¬¦ï¼Œå°ºå¯¸ä¸º16x32
 137          /// @param x æ˜¾ç¤ºæ¨ªåæ ‡ï¼Œå–å€¼èŒƒå›´ä¸º0-127
 138          /// @param y æ˜¾ç¤ºçºµåæ ‡ï¼Œå–å€¼èŒƒå›´ä¸º0-7
 139          /// @param no è‡ªå»ºç¬¦å·åº“ï¼ˆF16X32ï¼‰ä¸­ç¬¦å·ç›¸åº”çš„åºå·
 140          /// @param FontStyle éœ€è¦æ˜¾ç¤ºå­—ç¬¦çš„é£æ ¼å­—ä½“ï¼Œ0ï¼šé»‘ä½“ 1ï¼šæ•°ç æ—¶é’Ÿä½“ 2ï¼šè¡¬çº¿ä½“
 141          void OLED_ShowLargeChar(unsigned char x, unsigned char y, unsigned char no, unsigned char FontStyle)
 142          {
 143   1          unsigned char t,i;
 144   1          for(i=0;i<4;i++)    //å­—ç¬¦é«˜åº¦ï¼Œé¡µæ‰«æï¼Œ16x32,32/8=4é¡µ
 145   1          {
 146   2              OLED_Set_Pos(x,y+i);
 147   2              for(t=0;t<16;t++)    //å†™å†…å®¹ï¼Œå­—ç¬¦å®½åº¦16
 148   2              {
 149   3                  if(FontStyle==0)   OLED_Write_Byte(Bold_F16X32[4*no+i][t],isData); 
 150   3                  if(FontStyle==1)   OLED_Write_Byte(Digital_Clock_F16x32[4*no+i][t],isData);
 151   3                  //if(FontStyle==1)   OLED_Write_Byte(Serif_F16x32[4*no+i][t],isData);
 152   3              }
 153   2          }
 154   1      }
 155          
 156          
 157          
 158          /// @brief åœ¨OLED12864ç‰¹å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²
 159          /// @param x åˆ—:0-128
 160          /// @param y è¡Œï¼š0-7
 161          /// @param DisplayStr éœ€è¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²
 162          void OLED_DisplayStr(uchar x, uchar y, uchar *DisplayStr) //(uchar *DisplayStr)æ”¹æˆ(uchar DisplayStr[])ä
             -¹Ÿå¯
 163          {
 164   1          uchar j = 0;
 165   1          while (DisplayStr[j] !=  '\0') //åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¾ç¤ºå®Œæˆ
 166   1          {
 167   2              OLED_DisplayChar(x, y, DisplayStr[j]);
 168   2              x += 8;
 169   2              if (x > 120 ) //å¦‚æœä¸€è¡Œä¸å¤Ÿæ˜¾ç¤ºäº†ï¼Œä»ä¸‹ä¸€è¡Œç»§ç»­æ˜¾ç¤º
 170   2              {
 171   3                  x = 0;
 172   3                  y++;
 173   3              }
 174   2              j++;
 175   2          }
 176   1      }
C51 COMPILER V9.00   OLED                                                                  01/08/2025 16:52:06 PAGE 4   

 177          
 178          
 179          /// @brief åœ¨OLED12864ç‰¹å®šä½ç½®æ˜¾ç¤º16X16æ±‰å­—
 180          /// @param x 0-127
 181          /// @param y 0-7
 182          /// @param Num æ±‰å­—åº“ä¸­æ±‰å­—ç¼–å·
 183          void OLED_DisplayCN(uchar x, uchar y, uchar Num)
 184          {
 185   1          uchar i;
 186   1          OLED_Set_Pos(x, y);
 187   1          for (i = 0; i < 16; i++)
 188   1              OLED_Write_Byte(FontCN[2 * Num][i], isData); //æ˜¾ç¤ºæ±‰å­—çš„ä¸ŠåŠéƒ¨åˆ†
 189   1          OLED_Set_Pos(x, y + 1);
 190   1          for (i = 0; i < 16; i++)
 191   1              OLED_Write_Byte(FontCN[2 * Num + 1][i], isData); //æ˜¾ç¤ºæ±‰å­—çš„ä¸‹åŠéƒ¨åˆ†
 192   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    949    ----
   CONSTANT SIZE    =   8000    ----
   XDATA SIZE       =   ----      26
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
